<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>N√∂v√©nyfigyel≈ë</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f0f7f3 0%, #e0f2f1 100%);
      overflow-x: hidden;
      color: #1b3a2a;
      text-align: center;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.8em;
      margin: 25px 0;
      color: #0d3b23;
      letter-spacing: 1px;
      text-shadow: 1px 1px 5px rgba(0,0,0,0.05);
    }

    .card {
      position: relative;
      background: rgba(255,255,255,0.9);
      border-radius: 30px;
      padding: 26px 22px 22px;
      margin: 22px auto;
      max-width: 420px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.35s ease, box-shadow 0.35s ease, outline 0.2s ease;
      outline: 0px solid rgba(76,175,80,0);
      cursor: pointer;
    }

    .card.selected {
      outline: 3px solid rgba(76,175,80,0.35);
      box-shadow: 0 26px 52px rgba(0,0,0,0.13);
    }

    .card::before, .card::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      opacity: 0.10;
      animation: float 12s infinite linear;
      pointer-events: none;
    }

    .card::before {
      width: 200px; height: 200px;
      background: #66bb6a;
      top: -50px; right: -80px;
    }

    .card::after {
      width: 150px; height: 150px;
      background: #43a047;
      bottom: -60px; left: -50px;
      animation-duration: 16s;
    }

    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
      100% { transform: translateY(0) rotate(360deg); }
    }

    .card:hover { transform: translateY(-6px); box-shadow: 0 28px 48px rgba(0,0,0,0.15); }

    input, select, button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 14px;
      border: none;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    input { background: #f0f7f3; }
    input:focus { box-shadow: 0 0 0 4px rgba(102,187,106,0.25); }

    select {
      background: #f0f7f3;
      padding-right: 40px;
      cursor: pointer;
    }

    button {
      background: linear-gradient(145deg, #66bb6a, #43a047);
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }

    button:hover {
      background: linear-gradient(145deg, #43a047, #66bb6a);
      transform: scale(1.03);
    }

    #logout { background: #ef5350; }
    #logout:hover { background: #d32f2f; }

    .gauge-container {
      position: relative;
      width: 220px;
      height: 220px;
      margin: 18px auto 8px;
    }

    @media (max-width: 480px) {
      .gauge-container { width: 180px; height: 180px; }
    }

    .gauge-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
    .gauge-bg { fill: none; stroke: #c8e6c9; stroke-width: 18; }
    .gauge-fill { fill: none; stroke-width: 18; stroke-linecap: round; transition: stroke-dashoffset 0.6s ease, stroke 0.4s ease; }

    .gauge-value {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      font-size: 32px;
      font-weight: bold;
      color: #1b3a2a;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.05);
      line-height: 1;
      white-space: nowrap;
      user-select: none;
    }

    @media (max-width: 480px) { .gauge-value { font-size: 24px; } }

    .battery-box {
      position: absolute;
      top: 16px;
      left: 16px;
      z-index: 6;
      display: none;
      background: none;
      border-radius: 0px;
      padding: 0px;
      box-shadow:none;
      backdrop-filter: blur(4px);
    }
    .battery-box img { width: 38px; display: block; }

    .deleteBtn {
      position: absolute;
      top: 16px; right: 16px;
      width: 40px; height: 40px;
      background: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 2px 10px rgba(220,0,60,0.10),0 1.5px 4px rgba(0,0,0,0.09);
      color: #d32f2f;
      font-weight: bold;
      font-size: 26px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: background 0.22s, color 0.22s, transform 0.14s;
      z-index: 7;
    }
    .deleteBtn:hover {
      background: #ffe3e3;
      color: #b71c1c;
      transform: scale(1.125);
      box-shadow: 0 6px 16px rgba(220,0,60,0.19);
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 4px;
      margin-bottom: 10px;
      position: relative;
      z-index: 2;
    }

    .plant-title-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;                 /* kisebb t√°vols√°g a sz√∂veg √©s ceruza k√∂z√∂tt */
      padding:6px 14px;        /* ALACSONYABB pill */
      border-radius:18px;      /* kicsit eleg√°nsabb */
      background:linear-gradient(
        145deg,
        rgba(102,187,106,0.32),
        rgba(67,160,71,0.22)
      );
      font-weight:700;         /* kev√©sb√© ‚Äût√∂mb√∂s‚Äù */
      font-size:16px;          /* EZ A KULCS */
      line-height:1.1;
      white-space:nowrap;
      width:fit-content;
      max-width:100%;
      box-shadow:0 10px 20px rgba(0,0,0,.07);
    }


    .edit-pill {
      border: none;
      width: auto;
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(67,160,71,0.12);
      color: #1b5e20;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 8px 16px rgba(0,0,0,0.06);
      transition: transform 0.2s ease, background 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .edit-pill:hover { transform: scale(1.06); background: rgba(67,160,71,0.17); }

    .name-edit-wrap {
      display: none;
      gap: 10px;
      align-items: center;
      justify-content: center;
      margin: 8px 0 10px;
      position: relative;
      z-index: 2;
    }

    .name-edit-wrap input {
      width: 72%;
      margin: 0;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(76,175,80,0.25);
      background: rgba(240,247,243,0.9);
    }

    .icon-btn {
      width: 46px;
      height: 46px;
      border-radius: 16px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #0d3b23;
      background: rgba(255,255,255,0.85);
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, background 0.2s ease;
    }
    .icon-btn:hover { transform: scale(1.06); background: rgba(255,255,255,0.95); }

    .name-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 16px;
      border-radius:18px;
      background:linear-gradient(
        145deg,
        rgba(102,187,106,0.25),
        rgba(67,160,71,0.20)
      );
      color:#0d3b23;
      font-weight:800;
      margin:6px auto 12px;
      width:fit-content;
      max-width:100%;
      white-space:nowrap;
      box-shadow:0 14px 26px rgba(0,0,0,0.06);
    }

    .plant-title-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 14px;        /* ‚¨Ö EZ A KULCS: alacsonyabb */
      border-radius:999px;     /* kapszula marad */
      background:linear-gradient(
        145deg,
        rgba(102,187,106,0.32),
        rgba(67,160,71,0.22)
      );
      font-weight:700;
      font-size:15px;          /* picit kisebb √∂sszhat√°s */
      line-height:1;           /* ‚¨Ö fontos, ne legyen magas */
      white-space:nowrap;
      width:fit-content;
      max-width:100%;
      box-shadow:0 6px 14px rgba(0,0,0,.07);
    }




    .slider-container { margin-top: 8px; position: relative; z-index: 2; }
    .led-slider {
      width: 92%; margin: 12px auto 6px; display: block;
      appearance: none; height: 18px; border-radius: 12px;
      background: linear-gradient(90deg, #e7ffe0 0%, #4caf50 100%);
      outline: none; transition: all 0.25s ease;
    }
    .led-slider::-webkit-slider-thumb {
      appearance: none; width: 28px; height: 28px; border-radius: 50%;
      background: #66bb6a; border: 3px solid #fff; cursor: pointer;
      box-shadow: 0 4px 12px rgba(76,175,80,0.2); transition: transform 0.25s ease;
    }
    .led-slider::-webkit-slider-thumb:hover { transform: scale(1.1); }

    .slider-labels { font-weight: 700; color: #1b3a2a; opacity: 0.9; font-size: 14px; margin-bottom: 4px; }

    /* Floating buttons */
    #addAccountBtn, #notifBellBtn, #chartsBtn {
      position: fixed;
      right: 25px;
      width: 65px;
      height: 65px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 6px 22px rgba(0,0,0,0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 1000;
      color: #fff;
      font-size: 32px;
      background: linear-gradient(145deg, #43a047, #66bb6a);
    }
    #addAccountBtn { bottom: 25px; font-size: 38px; z-index: 1000; }
    #notifBellBtn { bottom: 115px; font-size: 30px; z-index: 1001; }
    #chartsBtn { bottom: 205px; font-size: 28px; z-index: 1002; }

    #notifBellBtn.inactive {
      background: linear-gradient(145deg, #b0c4b1, #d0e6cd);
      color: #7e917c;
    }

    #addAccountBtn:hover, #notifBellBtn:hover, #chartsBtn:hover {
      transform: scale(1.08);
      box-shadow: 0 8px 28px rgba(0,0,0,0.25);
    }

    /* Modals */
    #modal, #confirmModal, #notifModal, #chartsModal {
      display: none;
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      justify-content: center; align-items: center;
      z-index: 1100;
      padding: 18px;
    }

    #modalContent, #confirmModalContent, #notifModalContent, #chartsModalContent {
      background: #ffffffee;
      padding: 30px 22px;
      border-radius: 28px;
      box-shadow: 0 20px 48px rgba(0,0,0,0.2);
      width: 420px;
      max-width: 95vw;
      text-align: center;
      position: relative;
      animation: popIn 0.25s ease-out;
      overflow: hidden;
    }

    @keyframes popIn {
      from { transform: scale(0.94); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    #modalClose, #confirmClose, #notifModalClose, #chartsModalClose {
      position: absolute;
      top: 14px;
      right: 18px;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      transition: color 0.2s ease;
      user-select: none;
      z-index: 5;
    }
    #modalClose:hover, #confirmClose:hover, #notifModalClose:hover, #chartsModalClose:hover { color: #111; }

    .charts-wrap {
      max-height: 70vh;
      overflow: auto;
      padding: 10px 6px 2px;
    }

    .chart-card {
      background: rgba(240,247,243,0.9);
      border-radius: 22px;
      padding: 14px 14px 12px;
      margin: 12px 0;
      box-shadow: 0 14px 26px rgba(0,0,0,0.07);
      text-align: left;
    }

    .chart-title {
      font-weight: 900;
      color: #0d3b23;
      font-size: 16px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .chart-title small {
      font-weight: 700;
      opacity: 0.7;
      font-size: 12px;
      white-space: nowrap;
    }

    canvas {
      width: 100%;
      height: 160px;
      background: rgba(255,255,255,0.8);
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
    }
    

    /* Confirm buttons */
    .confirm-btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 16px; }
    .confirm-btn { width: 45%; padding: 12px 14px; border-radius: 14px; border: none; cursor: pointer; font-weight: 800; }
    .confirm-igen { background: linear-gradient(145deg, #43a047, #66bb6a); color: #fff; }
    .confirm-nem { background: #e0e8e5; color: #4b5a52; }

    @media (max-width: 480px) {
      h1 { font-size: 2.2em; margin: 20px 0; }
      .card { margin: 18px 10px; padding: 24px 18px 18px; }
      #notifBellBtn, #addAccountBtn, #chartsBtn { width: 52px; height: 52px; font-size: 22px; right: 18px; }
      #addAccountBtn { font-size: 30px; }
      #chartsBtn { font-size: 20px; }
      #notifBellBtn { font-size: 20px; }
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, onValue, set, get, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCfo3UqEb77ihYOqSJZvIFVr2VRGf6dJ4w",
      authDomain: "plant-monitor-3976f.firebaseapp.com",
      databaseURL: "https://plant-monitor-3976f-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "plant-monitor-3976f",
      storageBucket: "plant-monitor-3976f.appspot.com",
      messagingSenderId: "705425147510",
      appId: "1:705425147510:web:71f15bde879f3672df8157",
      measurementId: "G-890H6FDBYE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    // expose Firebase helpers for non-module scripts
    window.__db = db;
    window.__ref = ref;
    window.__get = get;
    window.__set = set;
    window.__update = update;
    window.__onValue = onValue;


    // ====== UI elemek ======
    const loginForm = document.getElementById("loginForm");
    const emailInput = document.getElementById("email");
    const passInput  = document.getElementById("password");
    const statusDiv  = document.getElementById("status");
    const logoutBtn  = document.getElementById("logout");
    const plantDataCard = document.getElementById("plantData");

    const addAccountBtn = document.getElementById("addAccountBtn");
    const modal = document.getElementById("modal");
    const modalCloseBtn = document.getElementById("modalClose");
    const addNewAccountForm = document.getElementById("addNewAccountForm");
    const newAccountEmail = document.getElementById("newAccountEmail");
    const newAccountPass = document.getElementById("newAccountPass");
    const addAccountStatus = document.getElementById("addAccountStatus");
    const accountsContainer = document.getElementById("accountsContainer");

    const chartsBtn = document.getElementById("chartsBtn");
    const chartsModal = document.getElementById("chartsModal");
    const chartsModalClose = document.getElementById("chartsModalClose");
    const chartsWrap = document.getElementById("chartsWrap");

    // ====== T√°rol√°s (fi√≥kok) ======
    const STORAGE_KEY = "storedAccounts_v2";
    function getStoredAccounts() {
      try { const d = localStorage.getItem(STORAGE_KEY); return d ? JSON.parse(d) : []; } catch { return []; }
    }
    function setStoredAccounts(accs) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(accs));
    }
    function addStoredAccount(email, uid) {
      const accs = getStoredAccounts();
      if (!accs.some(a => a.uid === uid)) { accs.push({ email, uid }); setStoredAccounts(accs); }
    }
    function removeStoredAccount(uid) {
      const accs = getStoredAccounts().filter(a => a.uid !== uid);
      setStoredAccounts(accs);
    }

    // ====== Kateg√≥ri√°k ======
    const plantCategories = {
      "üåµSz√°razkedvel≈ë": { min: 10, max: 40 },
      "üåæM√©rs√©kelten sz√°raz": { min: 20, max: 45 },
      "üåøKiegyens√∫lyozott v√≠zig√©ny≈±": { min: 30, max: 60 },
      "üå±Nedvess√©gkedvel≈ë": { min: 50, max: 80 },
      "üíßV√≠zig√©nyes": { min: 70, max: 100 }
    };

    function getGradientColor(value) {
      let r, g, b;
      if (value <= 50) {
        const ratio = value / 50;
        r = 255;
        g = Math.round(69 + (215 - 69) * ratio);
        b = 0;
      } else {
        const ratio = (value - 50) / 50;
        r = Math.round(255 + (76 - 255) * ratio);
        g = Math.round(215 + (175 - 215) * ratio);
        b = Math.round(0 + (80 - 0) * ratio);
      }
      return `rgb(${r},${g},${b})`;
    }

    // ====== Eszk√∂z-k√°rty√°k (minden eszk√∂z k√ºl√∂n) ======
    // deviceCards: key = uid|deviceId -> { card, name, history[], canvas, lastUpdated }
    const deviceCards = new Map();

    // kiv√°lasztott eszk√∂z push-hoz
    window.jelenlegiEszkozID = null;

    function setSelectedDevice(deviceId) {
      window.jelenlegiEszkozID = deviceId;
      // kijel√∂l√©s vizu√°lisan
      for (const v of deviceCards.values()) v.card.classList.remove("selected");
      for (const [key, v] of deviceCards.entries()) {
        if (key.endsWith("|" + deviceId)) v.card.classList.add("selected");
      }
    }

    function showLoginScreen() {
      loginForm.style.display = "block";
      statusDiv.style.display = "block";
      logoutBtn.style.display = "none";
      plantDataCard.style.display = "block";
      accountsContainer.style.display = "none";
      addAccountBtn.style.display = "none";
      chartsBtn.style.display = "none";
      statusDiv.style.color = "#1b3a2a";
      statusDiv.textContent = "Nincs bejelentkezve";
    }

    function hideLoginScreen() {
      loginForm.style.display = "none";
      statusDiv.style.display = "none";
      logoutBtn.style.display = "none";
      plantDataCard.style.display = "none";
      accountsContainer.style.display = "block";
      addAccountBtn.style.display = "flex";
      chartsBtn.style.display = "flex";
    }

    // ====== Grafikon rajzol√°s (client-side history) ======
    function pushHistory(key, value) {
      const obj = deviceCards.get(key);
      if (!obj) return;
      const now = Date.now();
      obj.lastUpdated = now;
      obj.history.push({ t: now, v: value });
      if (obj.history.length > 60) obj.history.shift(); // kb 60 pont
    }

    function drawSimpleLineChart(canvas, history) {
      const ctx = canvas.getContext("2d");
      const w = canvas.width;
      const h = canvas.height;

      // h√°tt√©r
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "rgba(255,255,255,0.0)";
      ctx.fillRect(0,0,w,h);

      // r√°cs
      ctx.strokeStyle = "rgba(0,0,0,0.06)";
      ctx.lineWidth = 1;
      for (let i=1;i<=4;i++){
        const y = (h/5)*i;
        ctx.beginPath();
        ctx.moveTo(0,y);
        ctx.lineTo(w,y);
        ctx.stroke();
      }

      if (!history || history.length < 2) {
        ctx.fillStyle = "rgba(13,59,35,0.6)";
        ctx.font = "14px Roboto, Arial";
        ctx.fillText("Nincs el√©g adat a grafikonhoz (v√°rj p√°r friss√≠t√©st).", 12, 28);
        return;
      }

      const values = history.map(p => p.v);
      const minV = Math.min(...values, 0);
      const maxV = Math.max(...values, 100);
      const pad = 12;

      const xStep = (w - pad*2) / (history.length - 1);

      function yFromVal(v) {
        const norm = (v - minV) / (maxV - minV || 1);
        return h - pad - norm * (h - pad*2);
      }

      // vonal
      ctx.strokeStyle = "rgba(67,160,71,0.95)";
      ctx.lineWidth = 3;
      ctx.lineJoin = "round";
      ctx.lineCap = "round";
      ctx.beginPath();
      for (let i=0;i<history.length;i++){
        const x = pad + i * xStep;
        const y = yFromVal(history[i].v);
        if (i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.stroke();

      // pontok
      ctx.fillStyle = "rgba(13,59,35,0.75)";
      for (let i=0;i<history.length;i+=Math.ceil(history.length/10)){
        const x = pad + i * xStep;
        const y = yFromVal(history[i].v);
        ctx.beginPath();
        ctx.arc(x,y,3.5,0,Math.PI*2);
        ctx.fill();
      }

      // utols√≥ √©rt√©k
      const last = history[history.length-1].v;
      ctx.fillStyle = "rgba(13,59,35,0.75)";
      ctx.font = "700 14px Roboto, Arial";
      ctx.fillText("Utols√≥: " + last + "%", 12, 20);
    }

    function rebuildChartsModal() {
      chartsWrap.innerHTML = "";
      const items = Array.from(deviceCards.entries()).map(([key, obj]) => ({ key, ...obj }));
      items.sort((a,b)=> (b.lastUpdated||0) - (a.lastUpdated||0));

      for (const item of items) {
        const chartCard = document.createElement("div");
        chartCard.className = "chart-card";

        const title = document.createElement("div");
        title.className = "chart-title";

        const left = document.createElement("div");
        left.textContent = item.name || "N√∂v√©ny";

        const right = document.createElement("small");
        right.textContent = item.lastUpdated ? new Date(item.lastUpdated).toLocaleTimeString() : "";

        title.appendChild(left);
        title.appendChild(right);

        const canvas = document.createElement("canvas");
        // fix m√©ret a j√≥ rajzol√°shoz, CSS majd sk√°l√°zza
        canvas.width = 640;
        canvas.height = 200;

        chartCard.appendChild(title);
        chartCard.appendChild(canvas);

        chartsWrap.appendChild(chartCard);

        // rajzol√°s
        drawSimpleLineChart(canvas, item.history || []);
      }
    }

    function openChartsModal() {
      rebuildChartsModal();
      chartsModal.style.display = "flex";
    }

    function closeChartsModal() {
      chartsModal.style.display = "none";
    }

    chartsBtn.addEventListener("click", openChartsModal);
    chartsModalClose.addEventListener("click", closeChartsModal);
    window.addEventListener("click", (e)=>{ if (e.target === chartsModal) closeChartsModal(); });

    // ====== K√°rtya l√©trehoz√°sa egy konkr√©t eszk√∂zh√∂z ======
    function createDeviceCardForUser(uid, email, deviceId) {
      const key = uid + "|" + deviceId;

      // m√°r l√©tezik ‚Üí ne dupl√°zzuk
      if (deviceCards.has(key)) return;

      const plantTypes = [
        "üåµSz√°razkedvel≈ë",
        "üåæM√©rs√©kelten sz√°raz",
        "üåøKiegyens√∫lyozott v√≠zig√©ny≈±",
        "üå±Nedvess√©gkedvel≈ë",
        "üíßV√≠zig√©nyes"
      ];

      const selectId = `plantTypeSelect-${uid}-${deviceId}`;

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <button class="deleteBtn" aria-label="Fi√≥k t√∂rl√©se">‚úñ</button>

        <div class="battery-box">
          <img class="battery-icon" src="batteryPercent/battery_100.png" alt="akku">
        </div>

        <div class="title-row">
          <div class="plant-title-pill">
            <span class="plant-title">Rosso</span>
            <button class="edit-pill" aria-label="N√©v szerkeszt√©se">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>


        <div class="name-edit-wrap">
          <input type="text" class="name-input" maxlength="50" placeholder="N√∂v√©ny neve...">
          <button class="icon-btn ok-btn" type="button" aria-label="Ment√©s"><i class="fa-solid fa-check"></i></button>
          <button class="icon-btn cancel-btn" type="button" aria-label="M√©gse"><i class="fa-solid fa-xmark"></i></button>
        </div>


        <div class="gauge-container">
          <svg class="gauge-svg" width="200" height="200" viewBox="0 0 200 200">
            <circle class="gauge-bg" cx="100" cy="100" r="80"></circle>
            <circle class="gauge-fill" cx="100" cy="100" r="80"></circle>
          </svg>
          <div class="gauge-value">0%</div>
        </div>

        <div class="slider-container" style="display:none;">
          <input type="range" min="0" max="100" step="1" value="0" class="led-slider" />
          <div class="slider-labels"><span>F√©ny er≈ë</span></div>
        </div>

        <div style="margin-top:16px; margin-bottom:6px; position:relative; z-index:2;">
          <label for="${selectId}" style="font-weight:700; color:#1b3a2a; margin-bottom:6px; display:block;">N√∂v√©ny t√≠pusa:</label>
          <select id="${selectId}" class="plant-type-select" style="position:relative; z-index:2;">
            <option value="">V√°lassz kateg√≥ri√°t</option>
            ${plantTypes.map(t => `<option value="${t}">${t}</option>`).join("")}
          </select>
        </div>
      `;

      const deleteBtn = card.querySelector(".deleteBtn");
      const titleEl = card.querySelector(".plant-title");
      const badgeEl = card.querySelector(".name-badge");

      const editBtn = card.querySelector(".edit-pill");
      const editWrap = card.querySelector(".name-edit-wrap");
      const nameInput = card.querySelector(".name-input");
      const okBtn = card.querySelector(".ok-btn");
      const cancelBtn = card.querySelector(".cancel-btn");

      const gaugeValueEl = card.querySelector(".gauge-value");
      const gaugeCircleEl = card.querySelector(".gauge-fill");
      const sliderContainer = card.querySelector(".slider-container");
      const slider = card.querySelector(".led-slider");

      const batteryBox = card.querySelector(".battery-box");
      const batteryImg = card.querySelector(".battery-icon");

      // gauge stroke
      const R = 80;
      const C = 2 * Math.PI * R;
      gaugeCircleEl.style.strokeDasharray = C;
      gaugeCircleEl.style.strokeDashoffset = C;

      let currPercent = 0;
      let currCat = "";

      function updateAccountGauge(realPercent, cat) {
        let display = 0;
        if (plantCategories[cat]) {
          const { min, max } = plantCategories[cat];
          display = Math.round(((realPercent - min) / (max - min)) * 100);
          if (display < 0) display = 0;
          if (display > 100) display = 100;
        
        return display;
      } else {
          display = realPercent;
        }
        gaugeValueEl.textContent = display + "%";
        const offset = C - (display / 100) * C;
        gaugeCircleEl.style.strokeDashoffset = offset;
        const color = getGradientColor(display);
        gaugeCircleEl.style.stroke = color;
        gaugeValueEl.style.color = color;
      }

      // kiv√°laszt√°s (push-hoz)
      card.addEventListener("click", (e) => {
        // ha t√∂rl√©s / gomb nyom√°s -> ne √ºtk√∂zz√∂n
        if (e.target.closest(".deleteBtn") || e.target.closest(".edit-pill") || e.target.closest(".name-edit-wrap") || e.target.closest("select") || e.target.closest("input") ) return;
        window.jelenlegiUID = uid;
        window.jelenlegiEmail = email;
        setSelectedDevice(deviceId);
      });

      // alapb√≥l legyen kiv√°lasztva az els≈ë, ha m√©g nincs
      if (!window.jelenlegiEszkozID) window.jelenlegiUID = uid;
        window.jelenlegiEmail = email;
        setSelectedDevice(deviceId);

      // n√©v szerkeszt√©s UI
      function openEdit() {
        editWrap.style.display = "flex";
        editBtn.style.display = "none";
        nameInput.value = titleEl.textContent.trim() || "";
        nameInput.focus();
        nameInput.select();
      }
      function closeEdit() {
        editWrap.style.display = "none";
        editBtn.style.display = "inline-flex";
      }

      editBtn.addEventListener("click", (e)=>{ e.stopPropagation(); openEdit(); });
      cancelBtn.addEventListener("click", (e)=>{ e.stopPropagation(); closeEdit(); });

      okBtn.addEventListener("click", async (e)=> {
        e.stopPropagation();
        const newName = nameInput.value.trim();
        if (!newName) { closeEdit(); return; }
        titleEl.textContent = newName;
        titleEl.title = newName;
        
        closeEdit();
        await set(ref(db, `users/${uid}/devices/${deviceId}/displayName`), newName);
      });

      nameInput.addEventListener("keydown", async (e)=> {
        if (e.key === "Escape") { closeEdit(); }
        if (e.key === "Enter") {
          const newName = nameInput.value.trim();
          if (!newName) { closeEdit(); return; }
          titleEl.textContent = newName;
          titleEl.title = newName;
          
          closeEdit();
          await set(ref(db, `users/${uid}/devices/${deviceId}/displayName`), newName);
        }
      });

      // t√∂rl√©s (csak fi√≥k elt√°vol√≠t√°s logika: UID t√∂rl√©se localstorage-b√≥l)
      deleteBtn.addEventListener("click", async (e) => {
        e.stopPropagation();
        const confirmed = await showConfirmModal("Biztosan t√∂rl√∂d ezt a fi√≥kot?");
        if (!confirmed) return;
        // elt√°vol√≠tjuk az √∂sszes ehhez az uid-hez tartoz√≥ k√°rty√°t
        removeAllCardsForUid(uid);
      });

      // Firebase: displayName
      const displayNameRef = ref(db, `users/${uid}/devices/${deviceId}/displayName`);
      onValue(displayNameRef, (snap) => {
        const v = snap.exists() ? String(snap.val() || "").trim() : "";
        const name = v || email;
        titleEl.textContent = name;
        titleEl.title = name;
        
        // sync a charts n√©vhez is
        const obj = deviceCards.get(key);
        if (obj) obj.name = v ? v : name;
      });

      // Firebase: plantType
      const selectElem = card.querySelector(`#${selectId}`);
      const plantTypeRef = ref(db, `users/${uid}/devices/${deviceId}/plantType`);
      onValue(plantTypeRef, (snap) => {
        const v = snap.exists() ? String(snap.val() || "") : "";
        if (v) {
          currCat = v;
          selectElem.value = v;
          updateAccountGauge(currPercent, currCat);
        }
      });
      selectElem.addEventListener("change", async (e)=> {
        e.stopPropagation();
        const v = e.target.value;
        currCat = v;
        updateAccountGauge(currPercent, currCat);
        await set(plantTypeRef, v);
      });

      // Firebase: soil sensor
      const soilRef = ref(db, `users/${uid}/devices/${deviceId}/sensorValue`);
      onValue(soilRef, (snap) => {
        if (!snap.exists()) return;
        const v = Number(snap.val());
        if (Number.isFinite(v)) {
          currPercent = v;
          const displayPct = updateAccountGauge(currPercent, currCat);
          if (window.__maybeEmailNotify) {
            window.__maybeEmailNotify({ uid, deviceId, displayPct, plantType: currCat, displayName: titleEl.textContent, fallbackEmail: email });
          }
          pushHistory(key, currPercent);
        }
      });

      // Firebase: LED (csak ha van)
      const ledLevelRef = ref(db, `users/${uid}/devices/${deviceId}/ledLevel`);
      get(ledLevelRef).then((snap) => {
        if (snap.exists()) {
          sliderContainer.style.display = "block";
          slider.value = Number(snap.val()) || 0;
          onValue(ledLevelRef, (s2) => {
            if (s2.exists()) slider.value = Number(s2.val()) || 0;
          });
          slider.addEventListener("input", async (e)=> {
            e.stopPropagation();
            const newVal = parseInt(e.target.value, 10);
            await set(ledLevelRef, newVal);
          });
        } else {
          sliderContainer.style.display = "none";
        }
      });

      // Firebase: battery (csak ha van)
      const batteryRef = ref(db, `users/${uid}/devices/${deviceId}/batteryPercent`);
      get(batteryRef).then((snap) => {
        if (!snap.exists()) {
          batteryBox.style.display = "none";
          return;
        }
        batteryBox.style.display = "block";
        onValue(batteryRef, (s2)=> {
          if (!s2.exists()) { batteryBox.style.display = "none"; return; }
          batteryBox.style.display = "block";
          const p = Number(s2.val());
          let icon = "battery_0.png";
          if (p >= 80) icon = "battery_100.png";
          else if (p >= 60) icon = "battery_75.png";
          else if (p >= 40) icon = "battery_50.png";
          else if (p >= 20) icon = "battery_25.png";
          batteryImg.src = `batteryPercent/${icon}`;
        });
      });

      // t√°roljuk
      deviceCards.set(key, {
        card,
        name: email,
        history: [],
        lastUpdated: 0
      });

      // k√°rtya hozz√°ad√°s a DOM-hoz
      accountsContainer.appendChild(card);

      // alap kijel√∂l√©s
      if (window.jelenlegiEszkozID === deviceId) card.classList.add("selected");
    }

    function removeAllCardsForUid(uid) {
      // t√∂r√∂lj√ºk localstorage-b√≥l
      removeStoredAccount(uid);

      // DOM + map t√∂rl√©s
      for (const [key, obj] of Array.from(deviceCards.entries())) {
        if (key.startsWith(uid + "|")) {
          obj.card.remove();
          deviceCards.delete(key);
        }
      }

      // ha nincs m√°r k√°rtya, vissza login
      if (deviceCards.size === 0) {
        showLoginScreen();
      } else {
        // v√°lasszunk egy marad√©k eszk√∂zt
        const first = Array.from(deviceCards.keys())[0];
        const devId = first.split("|")[1];
        setSelectedDevice(devId);
      }
    }

    // ====== Fi√≥k bet√∂lt√©s: UID -> devices -> minden eszk√∂z k√ºl√∂n k√°rtya ======
    async function addAccountByUid(uid, emailLabel) {
      // lek√©rj√ºk a devices csom√≥pontot
      const devicesSnap = await get(ref(db, `users/${uid}/devices`));
      if (!devicesSnap.exists()) return;

      const devicesData = devicesSnap.val();
      const deviceIds = Object.keys(devicesData || {});
      if (deviceIds.length === 0) return;

      // minden eszk√∂z k√ºl√∂n k√°rtya
      for (const deviceId of deviceIds) {
        createDeviceCardForUser(uid, emailLabel, deviceId);
      }

      // ha m√©g nincs kijel√∂lt device, az els≈ë legyen
      if (!window.jelenlegiEszkozID) setSelectedDevice(deviceIds[0]);
    }

    // ====== Login / fi√≥k hozz√°ad√°s ======
    window.addEventListener("load", async () => {
      const stored = getStoredAccounts();
      if (stored.length > 0) {
        hideLoginScreen();
        for (const acc of stored) {
          await addAccountByUid(acc.uid, acc.email || "Fi√≥k");
        }
      } else {
        showLoginScreen();
      }
    });

    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusDiv.style.color = "green";
      statusDiv.textContent = "Bejelentkez√©s...";

      try {
        const userCred = await signInWithEmailAndPassword(auth, emailInput.value, passInput.value);
        const user = userCred.user;

        // localstorage hozz√°ad√°s
        addStoredAccount(emailInput.value, user.uid);

        // k√°rty√°k l√©trehoz√°sa
        hideLoginScreen();
        await addAccountByUid(user.uid, emailInput.value);

        statusDiv.textContent = "";
      } catch (err) {
        statusDiv.style.color = "red";
        if (["auth/invalid-credential","auth/wrong-password","auth/user-not-found"].includes(err.code)) {
          statusDiv.textContent = "Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥!";
        } else {
          statusDiv.textContent = "Hiba: " + err.message;
        }
      }
    });

    addAccountBtn.addEventListener("click", () => {
      modal.style.display = "flex";
      addAccountStatus.textContent = "";
    });

    modalCloseBtn.addEventListener("click", () => { modal.style.display = "none"; });
    window.addEventListener("click", (e)=>{ if (e.target === modal) modal.style.display = "none"; });

    addNewAccountForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = newAccountEmail.value.trim();
      const pass  = newAccountPass.value.trim();

      addAccountStatus.textContent = "";

      const stored = getStoredAccounts();
      if (stored.some(acc => (acc.email || "").toLowerCase() === email.toLowerCase())) {
        addAccountStatus.style.color = "red";
        addAccountStatus.textContent = "Ez a fi√≥k m√°r hozz√° van adva!";
        return;
      }

      try {
        const userCred = await signInWithEmailAndPassword(auth, email, pass);
        const uid = userCred.user.uid;

        addStoredAccount(email, uid);
        await addAccountByUid(uid, email);

        modal.style.display = "none";
        newAccountEmail.value = "";
        newAccountPass.value = "";
        addAccountStatus.textContent = "";

      } catch (err) {
        addAccountStatus.style.color = "red";
        if (err.code === "auth/invalid-credential") {
          addAccountStatus.textContent = "Hib√°s email vagy jelsz√≥.";
        } else {
          addAccountStatus.textContent = "Hiba t√∂rt√©nt: " + err.message;
        }
      }
    });

    logoutBtn.style.display = "none";
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      showLoginScreen();
    });

    // ====== Confirm modal ======
    let confirmResolve = null;
    function showConfirmModal(message) {
      return new Promise((resolve) => {
        const modal = document.getElementById("confirmModal");
        document.getElementById("confirmText").innerText = message;
        modal.style.display = "flex";
        confirmResolve = resolve;
      });
    }
    function hideConfirmModal() {
      const modal = document.getElementById("confirmModal");
      modal.style.display = "none";
      if (confirmResolve) confirmResolve(false);
      confirmResolve = null;
    }

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("confirmIgenBtn").addEventListener("click", () => {
        const modal = document.getElementById("confirmModal");
        modal.style.display = "none";
        if (confirmResolve) confirmResolve(true);
        confirmResolve = null;
      });
      document.getElementById("confirmNemBtn").addEventListener("click", () => { hideConfirmModal(); });
      document.getElementById("confirmClose").addEventListener("click", () => { hideConfirmModal(); });
      window.addEventListener("keydown", (e) => {
        if(e.key === "Escape" && document.getElementById("confirmModal").style.display === "flex") hideConfirmModal();
      });
    });

    // ====== Expose for push script ======
    window.__setSelectedDevice = setSelectedDevice;
  </script>

  
  <!-- Email √©rtes√≠t√©s (Google Apps Script Web App) -->
  <script>
    // 1) Ide illeszd be a Google Apps Script /exec URL-t
    const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/u/0/home/projects/1pICFtAXxJ0zS7J2z5g9DZwK7jrcPZkxdDcgUm26tk5fNs70JjcC19zSn/edit";

    // 2) K√ºsz√∂b√∂k: itt a "kijelzett %" alapj√°n d√∂nt√ºnk (amit a kateg√≥ria sk√°l√°z)
    const EMAIL_THRESHOLD = 35;

    // 3) V√©delem: ne spam-eljen (6 √≥ra)
    const DEFAULT_COOLDOWN_MS = 6 * 60 * 60 * 1000;

    // Kulcs: per-uid + device
    function keyFor(uid, deviceId) {
      return `emailNotif|${uid}|${deviceId}`;
    }

    // Firebase el√©r√©s a module scriptb≈ël
    function fb() {
      return {
        db: window.__db,
        ref: window.__ref,
        get: window.__get,
        set: window.__set,
        update: window.__update,
        onValue: window.__onValue
      };
    }

    // UI √°llapot
    let emailNotifEnabled = false;

    async function loadEmailSettings(uid, deviceId) {
      const { db, ref, get } = fb();
      const base = `users/${uid}/devices/${deviceId}`;
      const [enSnap, emSnap] = await Promise.all([
        get(ref(db, `${base}/emailNotifEnabled`)),
        get(ref(db, `${base}/emailNotifEmail`))
      ]);
      return {
        enabled: enSnap.exists() ? !!enSnap.val() : false,
        email: emSnap.exists() ? String(emSnap.val() || "") : ""
      };
    }

    async function saveEmailSettings(uid, deviceId, enabled, email) {
      const { db, ref, update } = fb();
      const base = `users/${uid}/devices/${deviceId}`;
      await update(ref(db, base), {
        emailNotifEnabled: !!enabled,
        emailNotifEmail: String(email || ""),
        emailNotifCooldownMs: DEFAULT_COOLDOWN_MS
      });
      localStorage.setItem(keyFor(uid, deviceId), enabled ? "1" : "0");
    }

    function updateBellUI() {
      const bellBtn = document.getElementById("notifBellBtn");
      if (!bellBtn) return;
      bellBtn.classList.toggle("inactive", !emailNotifEnabled);
    }

    async function sendEmailViaAppsScript(payload) {
      if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL.includes("PASTE_")) {
        console.warn("Hi√°nyzik a GOOGLE_APPS_SCRIPT_URL az index.html-ben.");
        return;
      }
      try {
        await fetch(GOOGLE_APPS_SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (e) {
        console.warn("Email k√ºld√©s hiba (Apps Script):", e);
      }
    }

    // Ezt h√≠vja a k√°rtya, amikor friss√ºl a szenzor
    window.__maybeEmailNotify = async function({ uid, deviceId, displayPct, plantType, displayName, fallbackEmail }) {
      try {
        if (!uid || !deviceId) return;
        if (!Number.isFinite(displayPct)) return;
        if (displayPct > EMAIL_THRESHOLD) return;

        const { db, ref, get, set } = fb();
        const base = `users/${uid}/devices/${deviceId}`;

        // be van-e kapcsolva?
        const enSnap = await get(ref(db, `${base}/emailNotifEnabled`));
        const enabled = enSnap.exists() ? !!enSnap.val() : false;
        if (!enabled) return;

        // email
        const emSnap = await get(ref(db, `${base}/emailNotifEmail`));
        const email = (emSnap.exists() ? String(emSnap.val() || "") : "") || String(fallbackEmail || "");
        if (!email) return;

        // cooldown (Firebase-ben t√°rolt utols√≥ k√ºld√©s)
        const cdSnap = await get(ref(db, `${base}/emailNotifCooldownMs`));
        const cooldownMs = cdSnap.exists() ? Number(cdSnap.val()) : DEFAULT_COOLDOWN_MS;

        const lastSnap = await get(ref(db, `${base}/lastEmailSentAt`));
        const lastAt = lastSnap.exists() ? Number(lastSnap.val()) : 0;
        const now = Date.now();
        if (now - lastAt < cooldownMs) return;

        // el≈ësz√∂r be√≠rjuk, hogy "elk√ºld√©s folyamatban" (spam v√©delem)
        await set(ref(db, `${base}/lastEmailSentAt`), now);

        // k√ºld√©s
        await sendEmailViaAppsScript({
          email,
          deviceId,
          moisture: displayPct,
          category: plantType || "",
          plantName: displayName || ""
        });
      } catch (e) {
        console.warn("maybeEmailNotify hiba:", e);
      }
    };

    // Harang modal logika
    window.addEventListener("DOMContentLoaded", async function() {
      const bellBtn = document.getElementById("notifBellBtn");
      const notifModal = document.getElementById("notifModal");
      const closeBtn = document.getElementById("notifModalClose");
      const yesBtn = document.getElementById("notifYes");
      const noBtn = document.getElementById("notifNo");
      const emailInput = document.getElementById("notifEmailInput");

      function openModal() { if (notifModal) notifModal.style.display = "flex"; }
      function closeModal() { if (notifModal) notifModal.style.display = "none"; }

      if (!bellBtn) return;

      bellBtn.addEventListener("click", async () => {
        const uid = window.jelenlegiUID;
        const deviceId = window.jelenlegiEszkozID;
        if (!uid || !deviceId) {
          alert("El≈ëbb v√°lassz fi√≥kot + eszk√∂zt (kattints a k√°rty√°ra)!");
          return;
        }

        // beolvassuk az aktu√°lis be√°ll√≠t√°st Firebase-b≈ël
        const s = await loadEmailSettings(uid, deviceId);
        emailNotifEnabled = s.enabled;
        if (emailInput) {
          emailInput.value = s.email || window.jelenlegiEmail || "";
        }
        updateBellUI();
        openModal();
      });

      if (closeBtn) closeBtn.addEventListener("click", closeModal);
      window.addEventListener("click", (e) => { if (e.target === notifModal) closeModal(); });

      if (yesBtn) yesBtn.addEventListener("click", async () => {
        const uid = window.jelenlegiUID;
        const deviceId = window.jelenlegiEszkozID;
        const email = (emailInput && emailInput.value.trim()) || window.jelenlegiEmail || "";
        if (!email) {
          alert("√çrd be az email c√≠met!");
          return;
        }
        await saveEmailSettings(uid, deviceId, true, email);
        emailNotifEnabled = true;
        updateBellUI();
        closeModal();
        alert("K√©sz! Email √©rtes√≠t√©s bekapcsolva enn√©l a n√∂v√©nyn√©l.");
      });

      if (noBtn) noBtn.addEventListener("click", async () => {
        const uid = window.jelenlegiUID;
        const deviceId = window.jelenlegiEszkozID;
        await saveEmailSettings(uid, deviceId, false, "");
        emailNotifEnabled = false;
        updateBellUI();
        closeModal();
        alert("Email √©rtes√≠t√©s kikapcsolva enn√©l a n√∂v√©nyn√©l.");
      });

      // indul√°skor harang sz√≠ne (ha m√°r van v√°lasztott device k√©s≈ëbb friss√ºl)
      updateBellUI();
    });
  </script>

</head>

<body>
  <h1>N√∂v√©nyfigyel≈ë üå±</h1>

  <div class="card" id="plantData">
    <form id="loginForm">
      <h3>Bejelentkez√©s</h3>
      <input type="email" id="email" placeholder="Email" required><br>
      <input type="password" id="password" placeholder="Jelsz√≥" required><br>
      <button type="submit">Bel√©p√©s</button>
    </form>
    <button id="logout">Kijelentkez√©s</button>
    <p id="status">Nincs bejelentkezve</p>
    <div class="gauge-container" style="display:none"></div>
  </div>

  <div id="accountsContainer"></div>

  <button id="addAccountBtn" title="Fi√≥k hozz√°ad√°sa">+</button>

  <button id="notifBellBtn" aria-label="Email √©rtes√≠t√©s" title="Email √©rtes√≠t√©s">
    <i class="fa-solid fa-bell"></i>
  </button>

  <button id="chartsBtn" aria-label="Grafikonok" title="Grafikonok">
    <i class="fa-solid fa-chart-line"></i>
  </button>

  <div id="notifModal">
    <div id="notifModalContent">
      <span id="notifModalClose">&times;</span>
      <h3>Email √©rtes√≠t√©s be√°ll√≠t√°s</h3>
      <p>K√ºldjek emailt, ha a n√∂v√©ny <b>szomjas</b> (kijelzett √©rt√©k ‚â§ 35%)?</p>
      <input id="notifEmailInput" type="email" placeholder="Email c√≠m" style="margin-top:10px;" />
      <p style="margin-top:8px; opacity:.8; font-size:13px;">√úzenet p√©lda: <b>‚ÄûSzomjas a n√∂v√©nyed ‚Äì ideje locsolni! üíß‚Äù</b></p>
      <div style="margin-top:22px;">
        <button id="notifYes" style="background:linear-gradient(145deg,#43a047,#66bb6a);color:#fff;border:none;border-radius:12px;padding:10px 20px;font-size:17px;cursor:pointer;margin:0 9px; width:auto;">
          Igen
        </button>
        <button id="notifNo" style="background:#e0e8e5;color:#555;border:none;border-radius:12px;padding:10px 20px;font-size:17px;cursor:pointer;margin:0 9px; width:auto;">
          Nem
        </button>
      </div>
      <p style="margin-top:12px; opacity:.75; font-size:13px;">
        Tipp: v√°lassz ki egy k√°rty√°t (kattints r√°), √©s arra a n√∂v√©nyre fog vonatkozni az email √©rtes√≠t√©s.
      </p>
    </div>
  </div>

  <div id="chartsModal">
    <div id="chartsModalContent">
      <span id="chartsModalClose">&times;</span>
      <h3 style="color:#0d3b23; margin-bottom:6px;">Grafikonok</h3>
      <p style="opacity:.75; font-size:13px; margin-bottom:10px;">
        Csak megjelen√≠t√©s ‚Äî friss√ºl, ahogy j√∂nnek az adatok.
      </p>
      <div class="charts-wrap" id="chartsWrap"></div>
    </div>
  </div>

  <div id="modal">
    <div id="modalContent">
      <span id="modalClose">&times;</span>
      <h3>Fi√≥k hozz√°ad√°sa</h3>
      <form id="addNewAccountForm">
        <input type="email" id="newAccountEmail" placeholder="Email"><br>
        <input type="password" id="newAccountPass" placeholder="Jelsz√≥"><br>
        <button type="submit">Bel√©p√©s</button>
      </form>
      <p id="addAccountStatus"></p>
    </div>
  </div>

  <div id="confirmModal">
    <div id="confirmModalContent">
      <span id="confirmClose">&times;</span>
      <h3 id="confirmText">Biztosan t√∂rl√∂d ezt a fi√≥kot?</h3>
      <div class="confirm-btn-group">
        <button class="confirm-btn confirm-igen" id="confirmIgenBtn">Igen</button>
        <button class="confirm-btn confirm-nem" id="confirmNemBtn">Nem</button>
      </div>
    </div>
  </div>
</body>
</html>
